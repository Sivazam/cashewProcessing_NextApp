"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{77094:function(e,t,a){a.d(t,{o:function(){return b}});var r=a(57437),s=a(2265),n=a(74578),o=a(61865),l=a(38110),d=a(51872),c=a(71424),i=a(89314),u=a(12609),m=a(80459),f=a(51908),x=a(93023),p=a(37080),y=a(25831),h=a(58094),g=a(28203),j=a(39311),N=a(93330);let w=n.z.object({date:n.z.date(),amount:n.z.coerce.number().positive({message:"Amount must be a positive number."}),type:n.z.enum(["advance","payout"])});function b(e){let{open:t,onOpenChange:a,workerId:n,defaultType:b="advance"}=e,[v,k]=(0,s.useState)(!1),{addPayment:P}=(0,N.az)(),{updateWorker:_,workers:A}=(0,N.Es)(),{selectedFirmId:z}=(0,N.g6)(),{settings:D}=(0,N.F2)(),{workLogs:R,payments:Z,getWorkLogsByWorker:C,getPaymentsByWorker:I}=(0,N.az)(),W=A.find(e=>e.id===n),S=Z.filter(e=>e.workerId===(null==W?void 0:W.id)&&"payout"===e.type).reduce((e,t)=>e+t.amount,0);console.log("Updated Worker:",S);let V=(null==W?void 0:W.totalAmount)!==void 0?W.totalAmount-((null==W?void 0:W.advanceAmount)||0)-(S||0):0;console.log("Pending Amount:",V),console.log("Worker ID:",n),console.log("Selected Firm ID:",z),console.log("Worker:",W),console.log(">>>>>>>>Woker",W);let F=(0,o.cI)({resolver:(0,l.F)(w),defaultValues:{date:new Date,amount:0,type:b}}),J=F.watch("type"),K=async e=>{if(!z||!W){c.Am.error("Worker or firm not found");return}if("payout"===e.type&&e.amount>V){c.Am.error("Payout amount cannot exceed pending amount (".concat(D.currency).concat(V,")"));return}k(!0);try{let t={id:(0,d.Z)(),workerId:n,firmId:z,date:(0,i.ZP)(e.date,"yyyy-MM-dd"),amount:e.amount,type:e.type,createdAt:new Date().toISOString()};P(t),"advance"===e.type?_(n,{advanceAmount:(W.advanceAmount||0)+e.amount}):"payout"===e.type&&_(n,{payoutsMade:(W.payoutsMade||0)+e.amount}),c.Am.success("".concat("advance"===e.type?"Advance":"Payout"," recorded successfully")),F.reset({date:new Date,amount:0,type:b}),a(!1)}catch(t){c.Am.error("Failed to record ".concat(e.type)),console.error(t)}finally{k(!1)}};return(0,r.jsx)(u.Vq,{open:t,onOpenChange:a,children:(0,r.jsxs)(u.cZ,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(u.fK,{children:[(0,r.jsx)(u.$N,{children:"Record Payment"}),(0,r.jsxs)(u.Be,{children:["Record an advance or payout for ",(null==W?void 0:W.name)||"worker","."]})]}),(0,r.jsx)(m.l0,{...F,children:(0,r.jsxs)("form",{onSubmit:F.handleSubmit(K),className:"space-y-4",children:[(0,r.jsx)(m.Wi,{control:F.control,name:"type",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.xJ,{children:[(0,r.jsx)(m.lX,{children:"Payment Type"}),(0,r.jsxs)(h.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,r.jsx)(m.NI,{children:(0,r.jsx)(h.i4,{children:(0,r.jsx)(h.ki,{placeholder:"Select payment type"})})}),(0,r.jsxs)(h.Bw,{children:[(0,r.jsx)(h.Ql,{value:"advance",children:"Advance"}),(0,r.jsx)(h.Ql,{value:"payout",children:"Payout"})]})]}),(0,r.jsx)(m.zG,{})]})}}),(0,r.jsx)(m.Wi,{control:F.control,name:"date",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.xJ,{className:"flex flex-col",children:[(0,r.jsx)(m.lX,{children:"Date"}),(0,r.jsxs)(y.J2,{children:[(0,r.jsx)(y.xo,{asChild:!0,children:(0,r.jsx)(m.NI,{children:(0,r.jsxs)(x.z,{variant:"outline",className:(0,j.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,i.ZP)(t.value,"PPP"):(0,r.jsx)("span",{children:"Pick a date"}),(0,r.jsx)(g.Z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,r.jsx)(y.yk,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(p.f,{mode:"single",selected:t.value,onSelect:t.onChange,disabled:e=>e>new Date||e<new Date("1900-01-01"),initialFocus:!0})})]}),(0,r.jsx)(m.zG,{})]})}}),(0,r.jsx)(m.Wi,{control:F.control,name:"amount",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.xJ,{children:[(0,r.jsx)(m.lX,{children:"Amount"}),(0,r.jsx)(m.NI,{children:(0,r.jsx)(f.I,{type:"number",placeholder:"Enter amount",...t,onChange:e=>t.onChange(e.target.valueAsNumber)})}),"payout"===J&&(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Available for payout: ",D.currency," ",V]}),(0,r.jsx)(m.zG,{})]})}}),(0,r.jsx)(u.cN,{children:(0,r.jsx)(x.z,{type:"submit",disabled:v,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:v?"Processing...":"Record Payment"})})]})})]})})}},87516:function(e,t,a){a.d(t,{OL:function(){return h},_T:function(){return m},aR:function(){return d},f$:function(){return p},fY:function(){return f},le:function(){return g},vW:function(){return c},xo:function(){return x},yT:function(){return y}});var r=a(57437),s=a(2265),n=a(52506),o=a(39311),l=a(93023);let d=n.fC,c=n.xz,i=n.h_,u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t})});u.displayName=n.aV.displayName;let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)(i,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(n.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]})});m.displayName=n.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};f.displayName="AlertDialogHeader";let x=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="AlertDialogFooter";let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold",a),...s})});p.displayName=n.Dx.displayName;let y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})});y.displayName=n.dk.displayName;let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aU,{ref:t,className:(0,o.cn)((0,l.d)(),a),...s})});h.displayName=n.aU.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.$j,{ref:t,className:(0,o.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...s})});g.displayName=n.$j.displayName},37080:function(e,t,a){a.d(t,{f:function(){return c}});var r=a(57437);a(2265);var s=a(81291),n=a(17158),o=a(17859),l=a(39311),d=a(93023);function c(e){let{className:t,classNames:a,showOutsideDays:c=!0,...i}=e;return(0,r.jsx)(o._W,{showOutsideDays:c,className:(0,l.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,l.cn)((0,d.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,l.cn)((0,d.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{...t}=e;return(0,r.jsx)(s.Z,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,r.jsx)(n.Z,{className:"h-4 w-4"})}},...i})}c.displayName="Calendar"},58094:function(e,t,a){a.d(t,{Bw:function(){return p},Ph:function(){return i},Ql:function(){return h},i4:function(){return m},ki:function(){return u}});var r=a(57437),s=a(2265),n=a(20663),o=a(83523),l=a(9224),d=a(62442),c=a(39311);let i=n.fC;n.ZA;let u=n.B4,m=s.forwardRef((e,t)=>{let{className:a,children:s,...l}=e;return(0,r.jsxs)(n.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...l,children:[s,(0,r.jsx)(n.JO,{asChild:!0,children:(0,r.jsx)(o.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.xz.displayName;let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});f.displayName=n.u_.displayName;let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})});x.displayName=n.$G.displayName;let p=s.forwardRef((e,t)=>{let{className:a,children:s,position:o="popper",...l}=e;return(0,r.jsx)(n.h_,{children:(0,r.jsxs)(n.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===o&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:o,...l,children:[(0,r.jsx)(f,{}),(0,r.jsx)(n.l_,{className:(0,c.cn)("p-1","popper"===o&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(x,{})]})})});p.displayName=n.VY.displayName;let y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})});y.displayName=n.__.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,r.jsxs)(n.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(n.eT,{children:s})]})});h.displayName=n.ck.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...s})});g.displayName=n.Z0.displayName},11552:function(e,t,a){a.d(t,{e:function(){return w}});var r=a(57437),s=a(2265),n=a(74578),o=a(61865),l=a(38110),d=a(51872),c=a(71424),i=a(89314),u=a(12609),m=a(80459),f=a(51908),x=a(93023),p=a(37080),y=a(25831),h=a(28203),g=a(39311),j=a(93330);let N=n.z.object({date:n.z.date(),kgsProcessed:n.z.coerce.number().positive({message:"Kilograms must be a positive number."})});function w(e){let{open:t,onOpenChange:a,workerId:n}=e,[w,b]=(0,s.useState)(!1),{addWorkLog:v}=(0,j.az)(),{updateWorker:k,workers:P}=(0,j.Es)(),{selectedFirmId:_}=(0,j.g6)(),{settings:A}=(0,j.F2)(),z=P.find(e=>e.id===n),D=(0,o.cI)({resolver:(0,l.F)(N),defaultValues:{date:new Date,kgsProcessed:0}}),R=async e=>{if(!_||!z){c.Am.error("Worker or firm not found");return}b(!0);try{let t=e.kgsProcessed*A.pricePerKg,r={id:(0,d.Z)(),workerId:n,firmId:_,date:(0,i.ZP)(e.date,"yyyy-MM-dd"),kgsProcessed:e.kgsProcessed,amountEarned:t,createdAt:new Date().toISOString()};v(r),k(n,{totalKgsProcessed:z.totalKgsProcessed+e.kgsProcessed,totalAmount:z.totalAmount+t}),c.Am.success("Work log added successfully"),D.reset({date:new Date,kgsProcessed:0}),a(!1)}catch(e){c.Am.error("Failed to add work log"),console.error(e)}finally{b(!1)}};return(0,r.jsx)(u.Vq,{open:t,onOpenChange:a,children:(0,r.jsxs)(u.cZ,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(u.fK,{children:[(0,r.jsx)(u.$N,{children:"Add Work Log"}),(0,r.jsxs)(u.Be,{children:["Record work done by ",(null==z?void 0:z.name)||"worker","."]})]}),(0,r.jsx)(m.l0,{...D,children:(0,r.jsxs)("form",{onSubmit:D.handleSubmit(R),className:"space-y-4",children:[(0,r.jsx)(m.Wi,{control:D.control,name:"date",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.xJ,{className:"flex flex-col",children:[(0,r.jsx)(m.lX,{children:"Date"}),(0,r.jsxs)(y.J2,{children:[(0,r.jsx)(y.xo,{asChild:!0,children:(0,r.jsx)(m.NI,{children:(0,r.jsxs)(x.z,{variant:"outline",className:(0,g.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,i.ZP)(t.value,"PPP"):(0,r.jsx)("span",{children:"Pick a date"}),(0,r.jsx)(h.Z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,r.jsx)(y.yk,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(p.f,{mode:"single",selected:t.value,onSelect:t.onChange,disabled:e=>e>new Date||e<new Date("1900-01-01"),initialFocus:!0})})]}),(0,r.jsx)(m.zG,{})]})}}),(0,r.jsx)(m.Wi,{control:D.control,name:"kgsProcessed",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.xJ,{children:[(0,r.jsx)(m.lX,{children:"Kilograms Processed"}),(0,r.jsx)(m.NI,{children:(0,r.jsx)(f.I,{type:"number",placeholder:"Enter kilograms",...t,onChange:e=>t.onChange(e.target.valueAsNumber)})}),(0,r.jsx)(m.zG,{})]})}}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Amount to be earned: ",A.currency," ",(D.watch("kgsProcessed")||0)*A.pricePerKg]}),(0,r.jsx)(u.cN,{children:(0,r.jsx)(x.z,{type:"submit",disabled:w,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:w?"Adding...":"Add Work Log"})})]})})]})})}}}]);