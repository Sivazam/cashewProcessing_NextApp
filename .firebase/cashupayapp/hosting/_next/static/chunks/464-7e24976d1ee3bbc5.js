"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[464],{53464:function(e,r,a){a.d(r,{T:function(){return b}});var s=a(57437),t=a(2265),l=a(74578),n=a(61865),c=a(38110),i=a(51872),o=a(71424),d=a(12609),u=a(80459),m=a(51908),h=a(93023),x=a(93330),j=a(4035),v=a(49954),p=a(82549),f=a(16691),g=a.n(f);let N=l.z.object({name:l.z.string().min(2,{message:"Worker name must be at least 2 characters."}),phone:l.z.string().optional(),avatar:l.z.string().optional()});function b(e){let{open:r,onOpenChange:a}=e,[l,f]=(0,t.useState)(!1),[b,w]=(0,t.useState)(null),[k,y]=(0,t.useState)(!1),z=(0,t.useRef)(null),A=(0,t.useRef)(null),C=(0,t.useRef)(null),{addWorker:I}=(0,x.Es)(),{selectedFirmId:O}=(0,x.g6)(),W=(0,n.cI)({resolver:(0,c.F)(N),defaultValues:{name:"",phone:"",avatar:""}}),E=async()=>{y(!0);try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});z.current&&(z.current.srcObject=e)}catch(e){console.error("Error accessing camera:",e),o.Am.error("Could not access camera"),y(!1)}},P=()=>{if(z.current&&z.current.srcObject){let e=z.current.srcObject,r=e.getTracks();r.forEach(e=>e.stop()),z.current.srcObject=null}y(!1)},S=async e=>{if(!O){o.Am.error("Please select a firm first");return}f(!0);try{let r={id:(0,i.Z)(),name:e.name,phone:e.phone||void 0,avatar:e.avatar||void 0,firmId:O,totalKgsProcessed:0,totalAmount:0,advanceAmount:0,createdAt:new Date().toISOString()};I(r),o.Am.success("Worker added successfully"),W.reset(),w(null),a(!1)}catch(e){o.Am.error("Failed to add worker"),console.error(e)}finally{f(!1)}};return(0,s.jsx)(d.Vq,{open:r,onOpenChange:e=>{!e&&k&&P(),a(e)},children:(0,s.jsxs)(d.cZ,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(d.fK,{children:[(0,s.jsx)(d.$N,{children:"Add New Worker"}),(0,s.jsx)(d.Be,{children:"Add a new worker to the selected firm."})]}),(0,s.jsx)(u.l0,{...W,children:(0,s.jsxs)("form",{onSubmit:W.handleSubmit(S),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)(u.lX,{className:"block mb-2",children:"Profile Picture (Optional)"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[!k&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.z,{type:"button",variant:"outline",size:"sm",onClick:E,className:"flex items-center gap-1",children:[(0,s.jsx)(j.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Camera"})]}),(0,s.jsxs)(h.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},className:"flex items-center gap-1",children:[(0,s.jsx)(v.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Gallery"})]}),(0,s.jsx)("input",{type:"file",accept:"image/*",ref:C,onChange:e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(a){let e=new FileReader;e.onload=e=>{var r;let a=null===(r=e.target)||void 0===r?void 0:r.result;w(a),W.setValue("avatar",a)},e.readAsDataURL(a)}},className:"hidden"})]}),k&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.z,{type:"button",variant:"default",size:"sm",onClick:()=>{if(z.current&&A.current){let e=z.current,r=A.current;r.width=e.videoWidth,r.height=e.videoHeight;let a=r.getContext("2d");if(a){a.drawImage(e,0,0,r.width,r.height);let s=r.toDataURL("image/jpeg");w(s),W.setValue("avatar",s),P()}}},className:"flex items-center gap-1",children:[(0,s.jsx)(j.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Take Photo"})]}),(0,s.jsxs)(h.z,{type:"button",variant:"outline",size:"sm",onClick:P,className:"flex items-center gap-1",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Cancel"})]})]})]}),(0,s.jsxs)("div",{className:"relative",children:[k?(0,s.jsx)("div",{className:"rounded-lg overflow-hidden bg-gray-100 mb-3 aspect-square max-h-48",children:(0,s.jsx)("video",{ref:z,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"})}):b?(0,s.jsxs)("div",{className:"relative rounded-lg overflow-hidden bg-gray-100 mb-3 aspect-square max-h-48",children:[(0,s.jsx)(g(),{src:b,alt:"Avatar preview",fill:!0,className:"object-cover"}),(0,s.jsx)(h.z,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-8 w-8 rounded-full",onClick:()=>{w(null),W.setValue("avatar",void 0),C.current&&(C.current.value="")},children:(0,s.jsx)(p.Z,{className:"h-4 w-4"})})]}):null,(0,s.jsx)("canvas",{ref:A,className:"hidden"})]})]}),(0,s.jsx)(u.Wi,{control:W.control,name:"name",render:e=>{let{field:r}=e;return(0,s.jsxs)(u.xJ,{children:[(0,s.jsx)(u.lX,{children:"Worker Name"}),(0,s.jsx)(u.NI,{children:(0,s.jsx)(m.I,{placeholder:"Enter worker name",...r})}),(0,s.jsx)(u.zG,{})]})}}),(0,s.jsx)(u.Wi,{control:W.control,name:"phone",render:e=>{let{field:r}=e;return(0,s.jsxs)(u.xJ,{children:[(0,s.jsx)(u.lX,{children:"Phone Number (Optional)"}),(0,s.jsx)(u.NI,{children:(0,s.jsx)(m.I,{placeholder:"Enter phone number",...r})}),(0,s.jsx)(u.zG,{})]})}}),(0,s.jsx)(d.cN,{children:(0,s.jsx)(h.z,{type:"submit",disabled:l||!O||k,className:"w-full",children:l?"Adding...":"Add Worker"})})]})})]})})}}}]);