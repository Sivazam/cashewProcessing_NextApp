(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{20067:function(){},72061:function(){},56748:function(e,t,a){Promise.resolve().then(a.bind(a,53588))},53588:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return B}});var r=a(57437),s=a(2265),d=a(82666),n=a(89314),l=a(79303),i=a(86110),c=a(93330);function o(){let[e,t]=(0,s.useState)(0),[a,d]=(0,s.useState)(0),[o,m]=(0,s.useState)(0),[u,x]=(0,s.useState)(0),{workLogs:y,payments:p}=(0,c.az)(),{selectedFirmId:f}=(0,c.g6)(),{settings:h}=(0,c.F2)(),{workers:g}=(0,c.Es)();return((0,s.useEffect)(()=>{if(!f)return;let e=(0,n.ZP)(new Date,"yyyy-MM-dd"),a=y.filter(t=>t.firmId===f&&t.date===e),r=a.reduce((e,t)=>e+t.kgsProcessed,0),s=a.reduce((e,t)=>e+t.amountEarned,0),l=p.filter(t=>t.firmId===f&&t.date===e),i=l.filter(e=>"advance"===e.type).reduce((e,t)=>e+t.amount,0),c=l.filter(e=>"payout"===e.type).reduce((e,t)=>e+t.amount,0);t(r),d(s),m(i),x(c)},[y,p,f,g]),f)?(0,r.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,r.jsxs)(i.Zb,{className:"overflow-hidden transition-all hover:shadow-md",children:[(0,r.jsxs)(i.Ol,{className:"bg-primary/5",children:[(0,r.jsx)(i.ll,{children:"Today's Summary"}),(0,r.jsx)(i.SZ,{children:(0,n.ZP)(new Date,"PPP")})]}),(0,r.jsx)(i.aY,{className:"pt-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Processed"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[e," kg"]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Amount Earned by all workers"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[h.currency," ",a]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Advances"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[h.currency," ",o]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Payouts Made"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[h.currency," ",u]})]})]})})]})}):(0,r.jsx)(i.Zb,{children:(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Today's Summary"}),(0,r.jsx)(i.SZ,{children:"Please select a firm to view today's summary"})]})})}function m(){let[e,t]=(0,s.useState)([]),{workLogs:a,payments:d}=(0,c.az)(),{workers:o}=(0,c.Es)(),{selectedFirmId:m}=(0,c.g6)(),{settings:u}=(0,c.F2)();return((0,s.useEffect)(()=>{if(!m)return;let e=a.filter(e=>e.firmId===m),r=d.filter(e=>e.firmId===m),s=e.map(e=>{let t=o.find(t=>t.id===e.workerId);return{id:e.id,type:"workLog",date:e.date,description:"".concat((null==t?void 0:t.name)||"Worker"," processed ").concat(e.kgsProcessed," kg"),timestamp:e.createdAt}}),n=r.map(e=>{let t=o.find(t=>t.id===e.workerId),a="advance"===e.type?"received an advance of":"was paid";return{id:e.id,type:"payment",date:e.date,description:"".concat((null==t?void 0:t.name)||"Worker"," ").concat(a," ").concat(u.currency).concat(e.amount),timestamp:e.createdAt}}),l=[...s,...n].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,10);t(l)},[a,d,o,m,u]),m)?(0,r.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:(0,r.jsxs)(i.Zb,{className:"overflow-hidden transition-all hover:shadow-md",children:[(0,r.jsxs)(i.Ol,{className:"bg-primary/5",children:[(0,r.jsx)(i.ll,{children:"Recent Activity"}),(0,r.jsx)(i.SZ,{children:"Latest activities in your processing unit"})]}),(0,r.jsx)(i.aY,{className:"pt-6",children:(0,r.jsx)("div",{className:"space-y-4",children:0===e.length?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No recent activities"}):e.map((e,t)=>(0,r.jsxs)(l.E.div,{className:"flex items-start space-x-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:.05*t},children:[(0,r.jsx)("div",{className:"min-w-10 pt-1",children:(0,r.jsx)("div",{className:"h-2 w-2 rounded-full ".concat("workLog"===e.type?"bg-primary":"bg-accent")})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium leading-none",children:e.description}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,n.ZP)(new Date(e.date),"PPP")})]})]},e.id))})})]})}):(0,r.jsx)(i.Zb,{children:(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Recent Activity"}),(0,r.jsx)(i.SZ,{children:"Please select a firm to view recent activities"})]})})}function u(e){let{title:t,value:a,type:s="number",icon:d,description:n}=e,{settings:o}=(0,c.F2)();return(0,r.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,r.jsxs)(i.Zb,{className:"overflow-hidden transition-all hover:shadow-md",children:[(0,r.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(i.ll,{className:"text-sm font-medium",children:t}),(0,r.jsx)("div",{className:"h-4 w-4 text-primary",children:d})]}),(0,r.jsxs)(i.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:"currency"===s?"".concat(o.currency," ").concat(a.toLocaleString()):"kg"===s?"".concat(a.toLocaleString()," kg"):a.toLocaleString()}),n&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:n})]})]})})}var x=a(6308),y=a(96918),p=a(72339),f=a(6754),h=a(23775),g=a(93023),w=a(58094),j=a(88613),v=a(7504),N=a(28203),k=a(25831),b=a(37080),P=a(91350),Z=a(71424),D=a(12609),M=a(51908),_=a(51872);function S(e){let{open:t,onOpenChange:a}=e,[d,n]=(0,s.useState)(!1),{addWorker:l,updateWorker:i,workers:o}=(0,c.Es)(),{addWorkLog:m,addPayment:u}=(0,c.az)(),{selectedFirmId:x}=(0,c.g6)();return(0,r.jsx)(D.Vq,{open:t,onOpenChange:a,children:(0,r.jsxs)(D.cZ,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(D.fK,{children:[(0,r.jsx)(D.$N,{children:"Upload Excel"}),(0,r.jsx)(D.Be,{children:"Upload an Excel file to create or update workers and their logs."})]}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsx)(M.I,{type:"file",accept:".xlsx",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;n(!0);let s=new FileReader;s.onload=async e=>{try{var t;let r=null===(t=e.target)||void 0===t?void 0:t.result;if(!r){Z.Am.error("Failed to read file");return}let s=v.ij(r,{type:"binary"}),d=s.SheetNames[0],n=s.Sheets[d],c=v.P6.sheet_to_json(n,{header:1});for(let e=4;e<c.length;e++){let t;let a=c[e],[r,s,d,n,y,p,f]=a;if(!s||!r)continue;t="string"==typeof r?new Date(r):"number"==typeof r?v.kS.parse_date_code(r):new Date,isNaN(t.getTime())&&(console.warn("Invalid date for worker ".concat(s,": ").concat(r)),t=new Date);let h=o.find(e=>e.name===s);if(h||(h={id:(0,_.Z)(),name:s,phone:"",firmId:x,totalKgsProcessed:0,totalAmount:0,advanceAmount:0,payoutsMade:0,createdAt:new Date().toISOString()},l(h)),d){let e={id:(0,_.Z)(),workerId:h.id,firmId:x,date:t.toISOString(),kgsProcessed:parseFloat(d),amountEarned:parseFloat(y||0),createdAt:new Date().toISOString()};m(e),i(h.id,{totalKgsProcessed:(h.totalKgsProcessed||0)+parseFloat(d),totalAmount:(h.totalAmount||0)+parseFloat(y||0)})}if(n){let e={id:(0,_.Z)(),workerId:h.id,firmId:x,date:t.toISOString(),amount:parseFloat(n),type:"advance",createdAt:new Date().toISOString()};u(e),i(h.id,{advanceAmount:(h.advanceAmount||0)+parseFloat(n)})}if(p){let e={id:(0,_.Z)(),workerId:h.id,firmId:x,date:t.toISOString(),amount:parseFloat(p),type:"payout",createdAt:new Date().toISOString()};u(e),i(h.id,{payoutsMade:(h.payoutsMade||0)+parseFloat(p)})}}Z.Am.success("Excel data uploaded successfully"),a(!1)}catch(e){Z.Am.error("Failed to upload Excel data"),console.error(e)}finally{n(!1)}},s.readAsBinaryString(r)},disabled:d})}),(0,r.jsx)(D.cN,{children:(0,r.jsx)(g.z,{onClick:()=>a(!1),disabled:d,children:"Cancel"})})]})})}function I(){let[e,t]=(0,s.useState)([]),[a,d]=(0,s.useState)(new Date),[l,o]=(0,s.useState)((0,x.Z)(new Date)),[m,u]=(0,s.useState)((0,y.Z)(new Date)),[Z,D]=(0,s.useState)("all"),[M,_]=(0,s.useState)("monthly"),{workers:I}=(0,c.Es)(),{workLogs:E,payments:A}=(0,c.az)(),{firms:F,selectedFirmId:O}=(0,c.g6)(),{settings:C}=(0,c.F2)(),{theme:z}=(0,P.F)(),[T,W]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{"monthly"===M&&a&&(o((0,x.Z)(a)),u((0,y.Z)(a)))},[a,M]),(0,s.useEffect)(()=>{if(!O)return;let e=I.filter(e=>e.firmId===O),r=l||(0,x.Z)(a),s=m||(0,y.Z)(a),d=[];if("all"===Z)d=e.map(e=>{let t=E.filter(t=>t.workerId===e.id&&(0,f.Z)(new Date(t.date),new Date(r.setHours(0,0,0,0)))&&(0,h.Z)(new Date(t.date),new Date(s.setHours(23,59,59,999)))),a=t.reduce((e,t)=>e+t.kgsProcessed,0),d=t.reduce((e,t)=>e+t.amountEarned,0),l=A.filter(t=>t.workerId===e.id&&"advance"===t.type&&(0,f.Z)(new Date(t.date),new Date(r.setHours(0,0,0,0)))&&(0,h.Z)(new Date(t.date),new Date(s.setHours(23,59,59,999)))),i=A.filter(t=>t.workerId===e.id&&"payout"===t.type&&(0,f.Z)(new Date(t.date),new Date(r.setHours(0,0,0,0)))&&(0,h.Z)(new Date(t.date),new Date(s.setHours(23,59,59,999)))),c=l.reduce((e,t)=>e+t.amount,0),o=i.reduce((e,t)=>e+t.amount,0),m=A.filter(t=>t.workerId===e.id&&"advance"===t.type).reduce((e,t)=>e+t.amount,0),u=A.filter(t=>t.workerId===e.id&&"clear_advance"===t.type).reduce((e,t)=>e+t.amount,0),x=A.filter(t=>t.workerId===e.id&&"payout"===t.type).reduce((e,t)=>e+t.amount,0),y=e.totalAmount-(m-u-x),p=[...new Set([...t.map(e=>(0,n.ZP)(new Date(e.date),"MMM dd")),...l.map(e=>(0,n.ZP)(new Date(e.date),"MMM dd")),...i.map(e=>(0,n.ZP)(new Date(e.date),"MMM dd"))])].sort().join(", ");return{date:p||"No activity",workerName:e.name,kgsProcessed:a,advancesGiven:c,payoutsMade:o,totalAmountEarned:d,pendingPayable:y,rawDate:s}}).filter(e=>e.kgsProcessed>0||e.advancesGiven>0||e.payoutsMade>0);else{let e=I.find(e=>e.id===Z);if(e){let t=new Set;E.filter(t=>t.workerId===e.id&&(0,f.Z)(new Date(t.date),new Date(r.setHours(0,0,0,0)))&&(0,h.Z)(new Date(t.date),new Date(s.setHours(23,59,59,999)))).forEach(e=>t.add((0,n.ZP)(new Date(e.date),"yyyy-MM-dd"))),A.filter(t=>t.workerId===e.id&&("advance"===t.type||"payout"===t.type||"clear_advance"===t.type)&&(0,f.Z)(new Date(t.date),new Date(r.setHours(0,0,0,0)))&&(0,h.Z)(new Date(t.date),new Date(s.setHours(23,59,59,999)))).forEach(e=>t.add((0,n.ZP)(new Date(e.date),"yyyy-MM-dd")));let a=Array.from(t).sort(),l=E.filter(t=>t.workerId===e.id&&(0,h.Z)(new Date(t.date),new Date(r))),i=l.reduce((e,t)=>e+t.amountEarned,0),c=A.filter(t=>t.workerId===e.id&&"advance"===t.type&&(0,h.Z)(new Date(t.date),new Date(r))).reduce((e,t)=>e+t.amount,0),o=A.filter(t=>t.workerId===e.id&&"clear_advance"===t.type&&(0,h.Z)(new Date(t.date),new Date(r))).reduce((e,t)=>e+t.amount,0),m=A.filter(t=>t.workerId===e.id&&"payout"===t.type&&(0,h.Z)(new Date(t.date),new Date(r))).reduce((e,t)=>e+t.amount,0),u=i,x=c,y=o,g=m;d=a.map(t=>{let a=new Date(t),r=E.filter(t=>t.workerId===e.id&&(0,p.Z)(new Date(t.date),a)),s=A.filter(t=>t.workerId===e.id&&"advance"===t.type&&(0,p.Z)(new Date(t.date),a)),d=A.filter(t=>t.workerId===e.id&&"clear_advance"===t.type&&(0,p.Z)(new Date(t.date),a)),l=A.filter(t=>t.workerId===e.id&&"payout"===t.type&&(0,p.Z)(new Date(t.date),a)),i=r.reduce((e,t)=>e+t.kgsProcessed,0),c=r.reduce((e,t)=>e+t.amountEarned,0),o=s.reduce((e,t)=>e+t.amount,0),m=d.reduce((e,t)=>e+t.amount,0),f=l.reduce((e,t)=>e+t.amount,0);u+=c,x+=o,y+=m,g+=f;let h=x-y,w=u-(h-g);return{date:(0,n.ZP)(a,"dd/MM/yyyy"),workerName:e.name,kgsProcessed:i,advancesGiven:o,payoutsMade:f,totalAmountEarned:c,pendingPayable:w,rawDate:a}})}}"all"===Z?d.sort((e,t)=>t.workerName.localeCompare(e.workerName)):d.sort((e,t)=>{var a,r;return((null===(a=e.rawDate)||void 0===a?void 0:a.getTime())||0)-((null===(r=t.rawDate)||void 0===r?void 0:r.getTime())||0)}),t(d)},[I,E,A,O,a,l,m,Z]),O)?(0,r.jsxs)(i.Zb,{className:"shadow-md border-0 overflow-hidden dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsxs)(i.Ol,{className:"space-y-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700",children:[(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)(i.ll,{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-gray-100",children:"Worker Daily Logs"})}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row flex-wrap justify-between items-center gap-4",children:[(0,r.jsx)("div",{className:"w-full sm:w-auto",children:(0,r.jsxs)(w.Ph,{value:Z,onValueChange:e=>D(e),children:[(0,r.jsx)(w.i4,{className:"w-full sm:w-48 focus:ring-2 focus:ring-blue-500",children:(0,r.jsx)(w.ki,{placeholder:"Select Worker"})}),(0,r.jsxs)(w.Bw,{className:"max-h-80",children:[(0,r.jsx)(w.Ql,{value:"all",children:"All Workers"}),I.filter(e=>e.firmId===O).sort((e,t)=>e.name.localeCompare(t.name)).map(e=>(0,r.jsx)(w.Ql,{value:e.id,children:e.name},e.id))]})]})}),(0,r.jsx)("div",{className:"w-full sm:w-auto",children:(0,r.jsxs)(w.Ph,{value:(0,n.ZP)(a,"yyyy-MM"),onValueChange:e=>d(new Date(e)),children:[(0,r.jsx)(w.i4,{className:"w-full sm:w-48 focus:ring-2 focus:ring-blue-500",children:(0,r.jsx)(w.ki,{placeholder:"Select Month"})}),(0,r.jsx)(w.Bw,{children:[...Array(12)].map((e,t)=>{let a=new Date(new Date().getFullYear(),new Date().getMonth()-t,1);return(0,r.jsx)(w.Ql,{value:(0,n.ZP)(a,"yyyy-MM"),children:(0,n.ZP)(a,"MMMM yyyy")},t)})})]})}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)(k.J2,{children:[(0,r.jsx)(k.xo,{asChild:!0,children:(0,r.jsxs)(g.z,{variant:"outline",className:"w-[140px] justify-start text-left font-normal focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)(N.Z,{className:"mr-2 h-4 w-4"}),l?(0,n.ZP)(l,"dd MMM yyyy"):"Start date"]})}),(0,r.jsx)(k.yk,{className:"w-auto p-0",children:(0,r.jsx)(b.f,{mode:"single",selected:l,onSelect:o,initialFocus:!0})})]}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"to"}),(0,r.jsxs)(k.J2,{children:[(0,r.jsx)(k.xo,{asChild:!0,children:(0,r.jsxs)(g.z,{variant:"outline",className:"w-[140px] justify-start text-left font-normal focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)(N.Z,{className:"mr-2 h-4 w-4"}),m?(0,n.ZP)(m,"dd MMM yyyy"):"End date"]})}),(0,r.jsx)(k.yk,{className:"w-auto p-0",children:(0,r.jsx)(b.f,{mode:"single",selected:m,onSelect:u,initialFocus:!0})})]})]})}),(0,r.jsx)(g.z,{onClick:()=>W(!0),children:"Upload CSV"}),(0,r.jsx)(S,{open:T,onOpenChange:W}),(0,r.jsx)(g.z,{onClick:()=>{var t;let r=F.find(e=>e.id===O),s=(null==r?void 0:r.name)||"Unknown Firm",d=l&&m?"".concat((0,n.ZP)(l,"dd MMM yyyy")," to ").concat((0,n.ZP)(m,"dd MMM yyyy")):(0,n.ZP)(a,"MMMM yyyy"),i="all"!==Z?(null===(t=I.find(e=>e.id===Z))||void 0===t?void 0:t.name)||"Unknown Worker":"All Workers",c=e.reduce((e,t)=>e+t.kgsProcessed,0),o=e.reduce((e,t)=>e+t.advancesGiven,0),u=e.reduce((e,t)=>e+t.totalAmountEarned,0),x=e.reduce((e,t)=>e+t.payoutsMade,0),y=e.length>0?e.reduce((e,t)=>e+t.pendingPayable,0):0,p=[["Firm Name",s],["Period",d],["Worker",i],[],["Date","Worker Name","Kgs Processed","Advances Given","Amount Earned","Payouts Made","Pending Payable"],...e.map(e=>[e.date,e.workerName,e.kgsProcessed,e.advancesGiven,e.totalAmountEarned,e.payoutsMade,e.pendingPayable]),[],["Totals","",c,o,u,x,y]],f=v.P6.aoa_to_sheet(p);[3,4,5,6].forEach(t=>{for(let a=5;a<5+e.length;a++){let e=v.P6.encode_cell({r:a,c:t});f[e]&&(f[e].z="₹"===C.currency?"[$₹]#,##0.00":"$#,##0.00")}let a=v.P6.encode_cell({r:5+e.length+2,c:t});f[a]&&(f[a].z="₹"===C.currency?"[$₹]#,##0.00":"$#,##0.00")});for(let t=5;t<5+e.length;t++){let e=v.P6.encode_cell({r:t,c:2});f[e]&&(f[e].z='#,##0.00 "kg"')}let h=v.P6.encode_cell({r:5+e.length+2,c:2});f[h]&&(f[h].z='#,##0.00 "kg"');for(let e=0;e<7;e++){let t=v.P6.encode_cell({r:4,c:e});f[t]||(f[t]={t:"s",v:""}),f[t].s={font:{bold:!0}}}let g=5+e.length+2;for(let e=0;e<7;e++){let t=v.P6.encode_cell({r:g,c:e});f[t]||(f[t]={t:"s",v:""}),f[t].s={font:{bold:!0}}}let w=v.P6.book_new();v.P6.book_append_sheet(w,f,"Worker Logs"),f["!cols"]=[{wch:12},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15}];let N=v.cW(w,{bookType:"xlsx",type:"array"}),k=new Blob([N],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b="worker_logs";if("all"!==Z){let e=I.find(e=>e.id===Z);e&&(b+="_".concat(e.name.toLowerCase().replace(/\s+/g,"_")))}l&&m?b+="_".concat((0,n.ZP)(l,"yyyy-MM-dd"),"_to_").concat((0,n.ZP)(m,"yyyy-MM-dd")):b+="_".concat((0,n.ZP)(a,"yyyy-MM")),(0,j.saveAs)(k,"".concat(b,".xlsx"))},disabled:0===e.length,className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Export as Excel"})]})]}),(0,r.jsx)(i.aY,{className:"p-0",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Worker Name"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Kgs Processed"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Advances Given"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total Amount Earned"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Payouts Made"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Pending Payable"})]})}),(0,r.jsxs)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[e.length>0?e.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:e.date}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100",children:e.workerName}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[e.kgsProcessed.toFixed(1)," kg"]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[C.currency," ",e.advancesGiven.toFixed(2)]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[C.currency," ",e.totalAmountEarned.toFixed(2)]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[C.currency," ",e.payoutsMade.toFixed(2)]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium ".concat(e.pendingPayable<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:[C.currency," ",e.pendingPayable.toFixed(2)]})]},t)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-sm text-gray-500 dark:text-gray-400",children:"No logs found for the selected period"})}),e.length>0&&(0,r.jsxs)("tr",{className:"bg-gray-100 dark:bg-gray-700 font-semibold text-sm",children:[(0,r.jsx)("td",{colSpan:2,className:"px-4 py-3 whitespace-nowrap text-gray-800 dark:text-white",children:"Totals"}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-gray-800 dark:text-white",children:[e.reduce((e,t)=>e+t.kgsProcessed,0).toFixed(1)," kg"]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-gray-800 dark:text-white",children:[C.currency," ",e.reduce((e,t)=>e+t.advancesGiven,0).toFixed(2)]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-gray-800 dark:text-white",children:[C.currency," ",e.reduce((e,t)=>e+t.totalAmountEarned,0).toFixed(2)]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-gray-800 dark:text-white",children:[C.currency," ",e.reduce((e,t)=>e+t.payoutsMade,0).toFixed(2)]}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap font-bold ".concat(0>e.reduce((e,t)=>e+t.pendingPayable,0)?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:[C.currency," ",e.reduce((e,t)=>e+t.pendingPayable,0).toFixed(2)]})]})]})]})})})]}):(0,r.jsx)(i.Zb,{className:"shadow-md border-0 dark:bg-gray-800 dark:border-gray-700",children:(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Worker Daily Logs"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Please select a firm to view worker daily logs"})]})})}var E=a(52694),A=a(45253),F=a(38227),O=a(16573),C=a(24235),z=a(50039),T=a(86812),W=a(19223);function L(){let[e,t]=(0,s.useState)([]),{workLogs:a}=(0,c.az)(),{selectedFirmId:d}=(0,c.g6)();return((0,s.useEffect)(()=>{if(!d)return;let e=Array.from({length:7},(e,t)=>(0,E.Z)(new Date,t)),r=e.map(e=>{let t=(0,n.ZP)(e,"dd/MM/yy"),r=(0,n.ZP)(e,"dd"),s=(null==a?void 0:a.filter(t=>t.firmId===d&&(0,n.ZP)(new Date(t.date),"yyyy-MM-dd")===(0,n.ZP)(e,"yyyy-MM-dd")).reduce((e,t)=>e+(t.kgsProcessed||0),0))||0;return{formattedDate:t,day:r,totalKgsProcessed:s}});t(r.reverse())},[a,d]),d)?e.every(e=>0===e.totalKgsProcessed)?(0,r.jsx)(i.Zb,{children:(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Last 7 Days Summary"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No data available for the last 7 days."})]})}):(0,r.jsxs)(i.Zb,{children:[(0,r.jsx)(i.Ol,{children:(0,r.jsx)(i.ll,{children:"Last 7 Days Summary"})}),(0,r.jsx)(i.aY,{children:(0,r.jsx)(A.h,{width:"100%",height:300,children:(0,r.jsxs)(F.w,{data:e,margin:{top:20,right:30,left:20,bottom:5},children:[(0,r.jsx)(O.q,{strokeDasharray:"3 3"}),(0,r.jsx)(C.K,{dataKey:"day"}),(0,r.jsx)(z.B,{}),(0,r.jsx)(T.u,{content:e=>{let{payload:t}=e;if(!t||0===t.length)return null;let a=t[0].payload;return(0,r.jsxs)("div",{className:"bg-background p-2 rounded shadow",children:[(0,r.jsx)("p",{children:a.formattedDate}),(0,r.jsxs)("p",{children:["Total Processed: ",a.totalKgsProcessed," kg"]})]})}}),(0,r.jsx)(W.x,{type:"monotone",dataKey:"totalKgsProcessed",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8",r:4},activeDot:{r:6}}),(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"colorProcessed",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,r.jsx)("stop",{offset:"5%",stopColor:"#8884d8",stopOpacity:.8}),(0,r.jsx)("stop",{offset:"95%",stopColor:"#8884d8",stopOpacity:0})]})}),(0,r.jsx)(W.x,{type:"monotone",dataKey:"totalKgsProcessed",stroke:"url(#colorProcessed)",fill:"url(#colorProcessed)",strokeWidth:2})]})})})]}):(0,r.jsx)(i.Zb,{children:(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Last 7 Days Summary"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please select a firm to view the last 7 days summary"})]})})}var K=a(25750),G=a(4322),R=a(34822),H=a(98783);function B(){let[e,t]=(0,s.useState)(!1),[a,n]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(0,c.cn)(),n(!1)},[]),(0,s.useEffect)(()=>{let e=()=>{if("visible"===document.visibilityState&&!a){t(!0);let e=setTimeout(()=>{t(!1)},3e3);return()=>clearTimeout(e)}};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[a]);let{workers:l}=(0,c.Es)(),{workLogs:i,payments:x}=(0,c.az)(),{selectedFirmId:y}=(0,c.g6)(),{settings:p}=(0,c.F2)(),f=l.filter(e=>e.firmId===y).length,h=i.filter(e=>e.firmId===y).reduce((e,t)=>e+t.kgsProcessed,0),g=l.filter(e=>e.firmId===y).reduce((e,t)=>{let a=x.filter(e=>e.workerId===t.id&&"advance"===e.type).reduce((e,t)=>e+(t.amount||0),0),r=x.filter(e=>e.workerId===t.id&&"clear_advance"===e.type).reduce((e,t)=>e+(t.amount||0),0),s=x.filter(e=>e.workerId===t.id&&"payout"===e.type).reduce((e,t)=>e+(t.amount||0),0);return e+(t.totalAmount||0)-(a-r)-s},0),w=x.filter(e=>e.firmId===y&&"advance"===e.type).reduce((e,t)=>e+(t.amount||0),0);return(0,r.jsxs)("div",{className:"flex min-h-screen flex-col pb-20",children:[(0,r.jsx)(d.$,{}),(0,r.jsxs)("div",{className:"flex-1 space-y-4 p-4 md:p-8 pt-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"})}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsx)(u,{title:"Total Workers",value:f,icon:(0,r.jsx)(K.Z,{className:"h-4 w-4"}),description:"Active workers in selected firm"}),(0,r.jsx)(u,{title:"Total Processed",value:h,type:"kg",icon:(0,r.jsx)(G.Z,{className:"h-4 w-4"}),description:"Total kilograms processed"}),(0,r.jsx)(u,{title:"Total Balance Payable",value:g,type:"currency",icon:(0,r.jsx)(R.Z,{className:"h-4 w-4"}),description:"Amount to be paid to workers"}),(0,r.jsx)(u,{title:"Total Advances Given",value:w,type:"currency",icon:(0,r.jsx)(H.Z,{className:"h-4 w-4"}),description:"Advances given to workers"})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsx)(o,{}),(0,r.jsx)(L,{})]}),(0,r.jsx)(I,{}),(0,r.jsx)(m,{})]})]})}},37080:function(e,t,a){"use strict";a.d(t,{f:function(){return c}});var r=a(57437);a(2265);var s=a(81291),d=a(17158),n=a(17859),l=a(39311),i=a(93023);function c(e){let{className:t,classNames:a,showOutsideDays:c=!0,...o}=e;return(0,r.jsx)(n._W,{showOutsideDays:c,className:(0,l.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,l.cn)((0,i.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,l.cn)((0,i.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{...t}=e;return(0,r.jsx)(s.Z,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,r.jsx)(d.Z,{className:"h-4 w-4"})}},...o})}c.displayName="Calendar"},58094:function(e,t,a){"use strict";a.d(t,{Bw:function(){return p},Ph:function(){return o},Ql:function(){return h},i4:function(){return u},ki:function(){return m}});var r=a(57437),s=a(2265),d=a(20663),n=a(83523),l=a(9224),i=a(62442),c=a(39311);let o=d.fC;d.ZA;let m=d.B4,u=s.forwardRef((e,t)=>{let{className:a,children:s,...l}=e;return(0,r.jsxs)(d.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...l,children:[s,(0,r.jsx)(d.JO,{asChild:!0,children:(0,r.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=d.xz.displayName;let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(d.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=d.u_.displayName;let y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(d.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(n.Z,{className:"h-4 w-4"})})});y.displayName=d.$G.displayName;let p=s.forwardRef((e,t)=>{let{className:a,children:s,position:n="popper",...l}=e;return(0,r.jsx)(d.h_,{children:(0,r.jsxs)(d.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...l,children:[(0,r.jsx)(x,{}),(0,r.jsx)(d.l_,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(y,{})]})})});p.displayName=d.VY.displayName;let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(d.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})});f.displayName=d.__.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsxs)(d.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(d.wU,{children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(d.eT,{children:s})]})});h.displayName=d.ck.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(d.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...s})});g.displayName=d.Z0.displayName}},function(e){e.O(0,[425,953,199,278,725,276,105,20,647,5,971,864,744],function(){return e(e.s=56748)}),_N_E=e.O()}]);